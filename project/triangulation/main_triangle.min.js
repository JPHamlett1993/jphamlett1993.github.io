/**
 * almond 0.2.6 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */

(function(){var requirejs,require,define;(function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!c(s,n)&&!c(a,n))throw new Error("No "+n);return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];return e=r[1],i&&(i=h(i,t),n=m(i)),i?n&&n.normalize?e=n.normalize(e,d(t)):e=h(e,t):(e=h(e,t),r=g(e),i=r[0],e=r[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return p(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}},t=function(t,n,u,f){var l,h,d,g,y,b=[],w;f=f||t;if(typeof u=="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f),h=g.f;if(h==="require")b[y]=i.require(t);else if(h==="exports")b[y]=i.exports(t),w=!0;else if(h==="module")l=b[y]=i.module(t);else if(c(s,h)||c(o,h)||c(a,h))b[y]=m(h);else{if(!g.p)throw new Error(t+" missing "+h);g.p.load(g.n,p(f,!0),v(h),{}),b[y]=s[h]}}d=u.apply(s[t],b);if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(d!==e||!w)s[t]=d}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):m(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n)},n.config=function(e){return u=e,u.deps&&n(u.deps,u.callback),n},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!c(s,e)&&!c(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("lib/almond-0.2.6",function(){}),function(e){if(typeof exports=="object"&&typeof module!="undefined")module.exports=e();else if(typeof define=="function"&&define.amd)define("lib/triangulate-image-with-polyfills",[],e);else{var t;typeof window!="undefined"?t=window:typeof global!="undefined"?t=global:typeof self!="undefined"?t=self:t=this,t.triangulate=e()}}(function(){var e,t,n;return function r(e,t,n){function i(o,u){if(!t[o]){if(!e[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=t[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return i(n?n:t)},l,l.exports,r,e,t,n)}return t[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=e("promise-polyfill"),o=r(s),u=e("./input/sanitizeInput"),a=r(u),f=e("./input/browser/fromImageToImageData"),l=r(f),c=e("./output/polygonsToImageData"),h=r(c),p=e("./output/polygonsToDataURL"),d=r(p),v=e("./output/polygonsToSVG"),m=r(v),g=e("./polygons/imageDataToPolygons"),y=r(g),b=e("webworkify"),w=r(b),E=e("./workers/triangulationWorker"),S=r(E);n["default"]=function(e){function t(){return e}function n(){var e=i({},F);return B||i(e,I),e}function r(){var e=i({},F);return j||i(e,q),e}function s(e){return C(l["default"],e)}function u(e){return C(l["default"],e,!0)}function f(e){return C(function(e){return e},e)}function c(e){return C(function(e){return e},e,!0)}function p(e){return k(function(e){return e},e)}function v(e){return k(function(e){return e},e,!0)}function g(e){return k(d["default"],e)}function b(e){return k(d["default"],e,!0)}function E(e){return k(h["default"],e)}function x(e){return k(h["default"],e,!0)}function T(e){return k(m["default"],e)}function N(e){return k(m["default"],e,!0)}function C(e,t,n){return D=!!n,B=function(){return D?e(t):new o["default"](function(n,r){try{var i=e(t);n(i)}catch(s){r(s)}})},L()?A():r()}function k(e,t,r){return P=!!r,j=function(n,r){return P?e(n,r,t):new o["default"](function(i,s){try{var o=e(n,r,t);i(o)}catch(u){s(u)}})},L()?A():n()}function L(){return B&&j}function A(){if(D&&P){var t=B(e),n=(0,y["default"])(t,e),r=j(n,t);return r}return new o["default"](function(t,n){var r;O().then(function(t){return r=t,M(r,e)},n).then(function(e){return _(e,r)},n).then(function(e){t(e)},n)})}function O(e){return new o["default"](function(t,n){if(D)try{var r=B(e);t(r)}catch(i){n(i)}else B(e).then(t,n)})}function M(e,t){return new o["default"](function(n,r){H.addEventListener("message",function(e){if(e.data&&e.data.polygonJSONStr){var t=JSON.parse(e.data.polygonJSONStr);n(t)}else r(e.data&&e.data.err?e.data.err:e)}),H.postMessage({params:t,imageData:e,imageDataWidth:e.width,imageDataHeight:e.height})})}function _(e,t){return new o["default"](function(n,r){if(P)try{var i=j(e,t);n(i)}catch(s){r(s)}else j(e,t).then(n,r)})}e=(0,a["default"])(e);var D=!1,P=!1,H=(0,w["default"])(S["default"]),B=void 0,j=void 0,F={getParams:t,getInput:n,getOutput:r},I={fromImage:s,fromImageSync:u,fromImageData:f,fromImageDataSync:c},q={toData:p,toDataSync:v,toDataURL:g,toDataURLSync:b,toImageData:E,toImageDataSync:x,toSVG:T,toSVGSync:N};return n()},t.exports=n["default"]},{"./input/browser/fromImageToImageData":5,"./input/sanitizeInput":7,"./output/polygonsToDataURL":8,"./output/polygonsToImageData":9,"./output/polygonsToSVG":10,"./polygons/imageDataToPolygons":16,"./workers/triangulationWorker":24,"promise-polyfill":27,webworkify:29}],2:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("canvas-browserify"),s=r(i);n["default"]=function(e){if("undefined"==typeof Uint8ClampedArray){if("undefined"==typeof window)throw new Error("Can't copy imageData in Webworker without Uint8ClampedArray support.");var t=(0,s["default"])(e.width,e.height),n=t.getContext("2d");return n.putImageData(e,0,0),n.getImageData(0,0,e.width,e.height)}return{width:e.width,height:e.height,data:new Uint8ClampedArray(e.data)}},t.exports=n["default"]},{"canvas-browserify":25}],3:[function(e,t,n){"use strict";function r(e){var t,n=[],r=2*e+1,i=r*r,s=.5*i|0;for(t=0;i>t;t++)n[t]=t===s?-i+1:1;return n}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=function(e,t,n,i){var s=r(n).slice(),o=parseInt(10*(t||.5),10)||1;i=i||1;var u,a,f=i?1/i:0;if(1!==f)for(u=0,a=s.length;u<s.length;u++)s[u]*=f;var l=e.data;a=l.length>>2;var c=new Uint8Array(a);for(S=0;a>S;S++)c[S]=l[S<<2];var h,p,d,v,m,g,y,b,w,E,S,x,T,N,C=0|e.width,k=0|e.height,L=Math.sqrt(s.length),A=.5*L|0;for(p=0;k>p;p+=o)for(x=p*C,h=0;C>h;h+=o){for(d=v=m=0,b=-A;A>=b;b++)if(E=p+b,T=E*C,N=(b+A)*L,E>=0&&k>E)for(y=-A;A>=y;y++)w=h+y,w>=0&&C>w&&(g=s[y+A+N])&&(d+=c[w+T]*g);0>d?d=0:d>255&&(d=255),l[h+x<<2]=255&d}return e},t.exports=n["default"]},{}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=function(e){for(var t=e.data.length,n=e.data,r=void 0,i=0;t>i;i+=4)r=.34*n[i]+.5*n[i+1]+.16*n[i+2],n[i]=r,n[i+1]=r,n[i+2]=r;return e.data=n,e},t.exports=n["default"]},{}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("canvas-browserify"),s=r(i),o=s["default"].Image;n["default"]=function(e){if(e instanceof HTMLImageElement){if(!e.naturalWidth||!e.naturalHeight||e.complete===!1)throw new Error("This this image hasn't finished loading: "+e.src);var t=new s["default"](e.naturalWidth,e.naturalHeight),n=t.getContext("2d");n.drawImage(e,0,0,t.width,t.height);var r=n.getImageData(0,0,t.width,t.height);return r.data&&r.data.length&&("undefined"==typeof r.width&&(r.width=e.naturalWidth),"undefined"==typeof r.height&&(r.height=e.naturalHeight)),r}throw new Error("This object does not seem to be an image.")},t.exports=n["default"]},{"canvas-browserify":25}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n["default"]={accuracy:.7,blur:40,fill:!0,stroke:!0,strokeWidth:.5,lineJoin:"miter",vertexCount:700},t.exports=n["default"]},{}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../util/clamp"),s=r(i),o=e("./defaultParams"),u=r(o),a=["miter","round","bevel"];n["default"]=function(e){return"object"!=typeof e&&(e={}),"number"!=typeof e.accuracy||isNaN(e.accuracy)?e.accuracy=u["default"].accuracy:e.accuracy=(0,s["default"])(e.accuracy,0,1),("number"!=typeof e.blur||isNaN(e.blur))&&(e.blur=u["default"].blur),e.blur<=0&&(e.blur=1),"string"!=typeof e.fill&&"boolean"!=typeof e.fill&&(e.fill=u["default"].fill),"string"!=typeof e.stroke&&"boolean"!=typeof e.stroke&&(e.stroke=u["default"].stroke),("number"!=typeof e.strokeWidth||isNaN(e.strokeWidth))&&(e.strokeWidth=u["default"].strokeWidth),("string"!=typeof e.lineJoin||-1===a.indexOf(e.lineJoin))&&(e.lineJoin=u["default"].lineJoin),e.gradients&&e.fill?e.gradients=!0:e.gradients=!1,e.gradients&&(("number"!=typeof e.gradientStops||isNaN(e.gradientStops)||e.gradientStops<2)&&(e.gradientStops=2),e.gradientStops=Math.round(e.gradientStops)),("number"!=typeof e.vertexCount||isNaN(e.vertexCount))&&(e.vertexCount=u["default"].vertexCount),e.vertexCount<=0&&(e.vertexCount=1),e},t.exports=n["default"]},{"../util/clamp":17,"./defaultParams":6}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("canvas-browserify"),s=r(i),o=e("../util/drawPolygonsOnContext"),u=r(o);n["default"]=function(e,t,n){var r=n&&n.dpr?n.dpr:1,i=n&&n.backgroundColor?n.backgroundColor:!1,o=new s["default"](t.width*r,t.height*r),a=o.getContext("2d");return i&&(a.fillStyle=i,a.fillRect(0,0,t.width*r,t.height*r),a.fillStyle="transparent"),(0,u["default"])(a,e,t,r),o.toDataURL()},t.exports=n["default"]},{"../util/drawPolygonsOnContext":19,"canvas-browserify":25}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("canvas-browserify"),s=r(i),o=e("../util/drawPolygonsOnContext"),u=r(o);n["default"]=function(e,t,n){var r=n&&n.dpr?n.dpr:1,i=n&&n.backgroundColor?n.backgroundColor:!1,o=new s["default"](t.width*r,t.height*r),a=o.getContext("2d");return i&&(a.fillStyle=i,a.fillRect(0,0,t.width*r,t.height*r),a.fillStyle="transparent"),(0,u["default"])(a,e,t,r),a.getImageData(0,0,t.width*r,t.height*r)},t.exports=n["default"]},{"../util/drawPolygonsOnContext":19,"canvas-browserify":25}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=function(e,t){var n="";e.length&&e[0].gradient&&(n="<defs>");var r="";e.forEach(function(e,t){var i=e.a,s=e.b,o=e.c;r+='<polygon points="'+i.x+","+i.y+" "+s.x+","+s.y+" "+o.x+","+o.y+'"',e.gradient?!function(){var i=e.boundingBox,s=((e.gradient.x1-i.x)/i.width*100).toFixed(3),o=((e.gradient.y1-i.y)/i.height*100).toFixed(3),u=((e.gradient.x2-i.x)/i.width*100).toFixed(3),a=((e.gradient.y2-i.y)/i.height*100).toFixed(3);n+='\n	<linearGradient id="gradient-'+t+'" x1="'+s+'%" y1="'+o+'%" x2="'+u+'%" y2="'+a+'%">';var f=e.gradient.colors.length-1;e.gradient.colors.forEach(function(e,t){var r="rgb("+e.r+", "+e.g+", "+e.b+")",i=(t/f*100).toFixed(3);n+='\n					<stop offset="'+i+'%" stop-color="'+r+'"/>\n				'}),n+="</linearGradient>",r+=' fill="url(#gradient-'+t+')"',e.strokeWidth>0&&(r+=' stroke="url(#gradient-'+t+')" stroke-width="'+e.strokeWidth+'" stroke-linejoin="'+e.lineJoin+'"')}():(r+=e.fill?' fill="'+e.fill+'"':' fill="transparent"',e.strokeColor&&(r+=' stroke="'+e.strokeColor+'" stroke-width="'+e.strokeWidth+'" stroke-linejoin="'+e.lineJoin+'"')),r+="/>\n	"}),n.length&&(n+="\n		</defs>");var i='<?xml version="1.0" standalone="yes"?>\n<svg width="'+t.width+'" height="'+t.height+'" xmlns="http://www.w3.org/2000/svg" version="1.1" >\n	'+n+"\n	"+r+"\n</svg>";return i},t.exports=n["default"]},{}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../util/getBoundingBox"),s=r(i);n["default"]=function(e,t,n){return e.forEach(function(e){e.boundingBox=(0,s["default"])([e.a,e.b,e.c])}),e.filter(function(e){return e.boundingBox.width>0&&e.boundingBox.height>0})},t.exports=n["default"]},{"../util/getBoundingBox":20}],12:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../util/getColorByPos"),s=r(i);n["default"]=function(e,t,n){var r=n.fill,i="string"==typeof r?n.fill:!1,o=n.stroke,u="string"==typeof o?n.stroke:!1,a=n.strokeWidth,f=n.lineJoin;return e.forEach(function(e,n){var l={x:.33333*(e.a.x+e.b.x+e.c.x),y:.33333*(e.a.y+e.b.y+e.c.y)},c=(0,s["default"])(l,t);r&&(e.fill=i||"rgb("+c.r+", "+c.g+", "+c.b+")"),o&&(u?e.strokeColor=u:e.strokeColor="rgb("+c.r+", "+c.g+", "+c.b+")",e.strokeWidth=a,e.lineJoin=f)}),e},t.exports=n["default"]},{"../util/getColorByPos":21}],13:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../util/luminance"),s=r(i),o=e("../util/distance"),u=r(o),a=e("../util/getColorByPos"),f=r(a);n["default"]=function(e,t,n){return e.forEach(function(e,r){var i={};"abc".split("").forEach(function(n){var r=(0,f["default"])(e[n],t);i[n]={key:n,color:r,x:e[n].x,y:e[n].y},i[n].luminance=(0,s["default"])(i[n].color);var o="abc".replace(n,"").split("");i[n].median={x:(e[o[0]].x+e[o[1]].x)/2,y:(e[o[0]].y+e[o[1]].y)/2},i[n].medianColor=(0,f["default"])(i[n].median,t),i[n].medianLuminance=(0,s["default"])(i[n].medianColor)});for(var o=[i.a,i.b,i.c].sort(function(e,t){return Math.abs(e.luminance-e.medianLuminance)-Math.abs(t.luminance-t.medianLuminance)}),a=o[0],l=o[0],c=a.median,h=[l],p=(0,u["default"])(l,c),d=1,v=n.gradientStops-2;v>d;d++){var m=d*(p/n.gradientStops),g=m/p,y={x:l.x+g*(c.x-l.x),y:l.y+g*(c.y-l.y)};h.push(y)}h.push(c),e.gradient={x1:a.x,y1:a.y,x2:a.median.x,y2:a.median.y,colors:h.map(function(e){return(0,f["default"])(e,t)})},n.stroke&&(e.strokeWidth=n.strokeWidth,e.lineJoin=n.lineJoin),i=null}),e},t.exports=n["default"]},{"../util/distance":18,"../util/getColorByPos":21,"../util/luminance":23}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=function(e,t,n){var r,i,s,o,u,a,f,l,c,h=parseInt(10*(n||.1),10)||1,p=t,d=e.width,v=e.height,m=e.data,g=[];for(i=0;v>i;i+=h)for(r=0;d>r;r+=h){for(l=c=0,s=-1;1>=s;s++)if(a=i+s,f=a*d,a>=0&&v>a)for(o=-1;1>=o;o++)u=r+o,u>=0&&d>u&&(l+=m[u+f<<2],c++);c&&(l/=c),l>p&&g.push({x:r,y:i})}return g},t.exports=n["default"]},{}],15:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return e.x*e.y-t.y*t.x}Object.defineProperty(n,"__esModule",{value:!0});var s=e("../util/clamp"),o=r(s);n["default"]=function(e,t,n,r,s){var u=[],a=2*Math.ceil(r/(100-n))+2*Math.ceil(s/(100-n))+2,f=Math.max(e.length,t),l=(0,o["default"])(f-a,0,t-a),c=f/l,h=0,p=0,d=0,v=0;for(e.sort(i),h=0,v=f;v>h;h+=c)u.push({x:e[~~h].x,y:e[~~h].y});for(p=0;r>p;p+=100-n)u.push({x:~~p,y:0}),u.push({x:~~p,y:s});for(d=0;s>d;d+=100-n)u.push({x:0,y:~~d}),u.push({x:r,y:~~d});return u.push({x:0,y:s}),u.push({x:r,y:s}),e=null,u},t.exports=n["default"]},{"../util/clamp":17}],16:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("stackblur-canvas"),s=r(i),o=e("delaunay-fast"),u=r(o),a=e("../util/isImageData"),f=r(a),l=e("../imagedata/copyImageData"),c=r(l),h=e("../imagedata/greyscale"),p=r(h),d=e("../imagedata/detectEdges"),v=r(d),m=e("./getEdgePoints"),g=r(m),y=e("./getVerticesFromPoints"),b=r(y),w=e("./addBoundingBoxesToPolygons"),E=r(w),S=e("./addColorToPolygons"),x=r(S),T=e("./addGradientsToPolygons"),N=r(T);n["default"]=function(e,t){if((0,f["default"])(e)){var n={width:e.width,height:e.height},r=(0,c["default"])(e),i=(0,c["default"])(e),o=s["default"].imageDataRGBA(r,0,0,n.width,n.height,t.blur),a=(0,p["default"])(o),l=(0,v["default"])(a),h=(0,g["default"])(l,50,t.accuracy),d=(0,b["default"])(h,t.vertexCount,t.accuracy,n.width,n.height),m=u["default"].triangulate(d);return m=(0,E["default"])(m),m=t.fill===!0&&t.gradients===!0?(0,N["default"])(m,i,t):(0,x["default"])(m,i,t)}throw new Error("Can't work with the imageData provided. It seems to be corrupt.")},t.exports=n["default"]},{"../imagedata/copyImageData":2,"../imagedata/detectEdges":3,"../imagedata/greyscale":4,"../util/isImageData":22,"./addBoundingBoxesToPolygons":11,"./addColorToPolygons":12,"./addGradientsToPolygons":13,"./getEdgePoints":14,"./getVerticesFromPoints":15,"delaunay-fast":26,"stackblur-canvas":28}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=function(e,t,n){return t>e?t:e>n?n:e},t.exports=n["default"]},{}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=function(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)},t.exports=n["default"]},{}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=function(e,t,n,r){return r=r||1,t.forEach(function(t,n){e.beginPath(),e.moveTo(t.a.x*r,t.a.y*r),e.lineTo(t.b.x*r,t.b.y*r),e.lineTo(t.c.x*r,t.c.y*r),e.lineTo(t.a.x*r,t.a.y*r),t.gradient?!function(){var n=e.createLinearGradient(t.gradient.x1*r,t.gradient.y1*r,t.gradient.x2*r,t.gradient.y2*r),i=t.gradient.colors.length-1;t.gradient.colors.forEach(function(e,t){var r="rgb("+e.r+", "+e.g+", "+e.b+")";n.addColorStop(t/i,r)}),e.fillStyle=n,e.fill(),t.strokeWidth>0&&(e.strokeStyle=n,e.lineWidth=t.strokeWidth*r,e.lineJoin=t.lineJoin,e.stroke())}():(t.fill&&(e.fillStyle=t.fill,e.fill()),t.strokeColor&&(e.strokeStyle=t.strokeColor,e.lineWidth=t.strokeWidth*r,e.lineJoin=t.lineJoin,e.stroke())),e.closePath()}),e},t.exports=n["default"]},{}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=function(e){var t=1/0,n=-1/0,r=1/0,i=-1/0;return e.forEach(function(e){e.x<t&&(t=e.x),e.y<r&&(r=e.y),e.x>n&&(n=e.x),e.y>i&&(i=e.y)}),{x:t,y:r,width:n-t,height:i-r}},t.exports=n["default"]},{}],21:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var n=(0,o["default"])(e.x,1,t.width-2),r=(0,o["default"])(e.y,1,t.height-2),i=(0|n)+(0|r)*t.width<<2;return i>=t.data.length&&(i=t.data.length-5),{r:t.data[i],g:t.data[i+1],b:t.data[i+2]}}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=i;var s=e("./clamp"),o=r(s);t.exports=n["default"]},{"./clamp":17}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=function(e){return e&&"number"==typeof e.width&&"number"==typeof e.height&&e.data&&"number"==typeof e.data.length},t.exports=n["default"]},{}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=function(e){var t=[e.r,e.g,e.b].map(function(e){return e/=255,.03928>=e?e/12.92:Math.pow((e+.055)/1.055,2.4)});return.2126*t[0]+.7152*t[1]+.0722*t[2]},t.exports=n["default"]},{}],24:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){e.addEventListener("message",function(t){if(t.data.imageData&&t.data.params)try{var n=t.data.imageData;"undefined"==typeof n.width&&"number"==typeof t.data.imageDataWidth&&(n.width=t.data.imageDataWidth),"undefined"==typeof n.height&&"number"==typeof t.data.imageDataHeight&&(n.height=t.data.imageDataHeight);var r=(0,o["default"])(t.data.imageData,t.data.params);e.postMessage({polygonJSONStr:JSON.stringify(r)})}catch(i){e.postMessage({err:i.message||i})}else t.data.imageData?e.postMessage({err:"Parameters are missing."}):e.postMessage({err:"ImageData is missing."});e.close()})}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=i;var s=e("../polygons/imageDataToPolygons"),o=r(s);t.exports=n["default"]},{"../polygons/imageDataToPolygons":16}],25:[function(e,t,n){var r=t.exports=function(t,n){var r=document.createElement("canvas");return r.width=t||300,r.height=n||150,r};r.Image=function(){var e=document.createElement("img");return e}},{}],26:[function(e,t,n){function r(e,t,n){this.a=e,this.b=t,this.c=n;var r=t.x-e.x,i=t.y-e.y,s=n.x-e.x,o=n.y-e.y,u=r*(e.x+t.x)+i*(e.y+t.y),a=s*(e.x+n.x)+o*(e.y+n.y),f=2*(r*(n.y-t.y)-i*(n.x-t.x)),l,c,h,p;Math.abs(f)<1e-6?(l=Math.min(e.x,t.x,n.x),c=Math.min(e.y,t.y,n.y),h=(Math.max(e.x,t.x,n.x)-l)*.5,p=(Math.max(e.y,t.y,n.y)-c)*.5,this.x=l+h,this.y=c+p,this.r=h*h+p*p):(this.x=(o*u-i*a)/f,this.y=(r*a-s*u)/f,h=this.x-e.x,p=this.y-e.y,this.r=h*h+p*p)}function i(e,t){return t.x-e.x}function s(e){var t=e.length,n,r,i,s,o;e:while(t){r=e[--t],n=e[--t],i=t;while(i){o=e[--i],s=e[--i];if(n===s&&r===o||n===o&&r===s){e.splice(t,2),e.splice(i,2),t-=2;continue e}}}}function o(e){if(e.length<3)return[];e.sort(i);var t=e.length-1,n=e[t].x,o=e[0].x,u=e[t].y,a=u;while(t--)e[t].y<u&&(u=e[t].y),e[t].y>a&&(a=e[t].y);var f=o-n,l=a-u,c=f>l?f:l,h=(o+n)*.5,p=(a+u)*.5,d=[new r({x:h-20*c,y:p-c,__sentinel:!0},{x:h,y:p+20*c,__sentinel:!0},{x:h+20*c,y:p-c,__sentinel:!0})],v=[],m=[],g,y,b;t=e.length;while(t--){m.length=0,g=d.length;while(g--){f=e[t].x-d[g].x;if(f>0&&f*f>d[g].r){v.push(d[g]),d.splice(g,1);continue}l=e[t].y-d[g].y;if(f*f+l*l>d[g].r)continue;m.push(d[g].a,d[g].b,d[g].b,d[g].c,d[g].c,d[g].a),d.splice(g,1)}s(m),g=m.length;while(g)b=m[--g],y=m[--g],d.push(new r(y,b,e[t]))}Array.prototype.push.apply(v,d),t=v.length;while(t--)(v[t].a.__sentinel||v[t].b.__sentinel||v[t].c.__sentinel)&&v.splice(t,1);return v}r.prototype.draw=function(e){e.beginPath(),e.moveTo(this.a.x,this.a.y),e.lineTo(this.b.x,this.b.y),e.lineTo(this.c.x,this.c.y),e.closePath(),e.stroke()},typeof t!="undefined"&&(t.exports={Triangle:r,triangulate:o})},{}],27:[function(e,t,n){(function(e){function i(e,t){return function(){e.apply(t,arguments)}}function o(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");if(typeof e!="function")throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],h(e,i(a,this),i(f,this))}function u(e){var t=this;if(this._state===null){this._deferreds.push(e);return}r(function(){var n=t._state?e.onFulfilled:e.onRejected;if(n===null){(t._state?e.resolve:e.reject)(t._value);return}var r;try{r=n(t._value)}catch(i){e.reject(i);return}e.resolve(r)})}function a(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&(typeof e=="object"||typeof e=="function")){var t=e.then;if(typeof t=="function"){h(i(t,e),i(a,this),i(f,this));return}}this._state=!0,this._value=e,l.call(this)}catch(n){f.call(this,n)}}function f(e){this._state=!1,this._value=e,l.call(this)}function l(){for(var e=0,t=this._deferreds.length;e<t;e++)u.call(this,this._deferreds[e]);this._deferreds=null}function c(e,t,n,r){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=n,this.reject=r}function h(e,t,n){var r=!1;try{e(function(e){if(r)return;r=!0,t(e)},function(e){if(r)return;r=!0,n(e)})}catch(i){if(r)return;r=!0,n(i)}}var n=setTimeout,r=typeof setImmediate=="function"&&setImmediate||function(e){n(e,1)},s=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};o.prototype["catch"]=function(e){return this.then(null,e)},o.prototype.then=function(e,t){var n=this;return new o(function(r,i){u.call(n,new c(e,t,r,i))})},o.all=function(){var e=Array.prototype.slice.call(arguments.length===1&&s(arguments[0])?arguments[0]:arguments);return new o(function(t,n){function i(s,o){try{if(o&&(typeof o=="object"||typeof o=="function")){var u=o.then;if(typeof u=="function"){u.call(o,function(e){i(s,e)},n);return}}e[s]=o,--r===0&&t(e)}catch(a){n(a)}}if(e.length===0)return t([]);var r=e.length;for(var s=0;s<e.length;s++)i(s,e[s])})},o.resolve=function(e){return e&&typeof e=="object"&&e.constructor===o?e:new o(function(t){t(e)})},o.reject=function(e){return new o(function(t,n){n(e)})},o.race=function(e){return new o(function(t,n){for(var r=0,i=e.length;r<i;r++)e[r].then(t,n)})},o._setImmediateFn=function(t){r=t},typeof t!="undefined"&&t.exports?t.exports=o:e.Promise||(e.Promise=o)})(this)},{}],28:[function(e,t,n){function s(e,t,n,r){if(typeof e=="string")var e=document.getElementById(e);else if(!e instanceof HTMLImageElement)return;var i=e.naturalWidth,s=e.naturalHeight;if(typeof t=="string")var t=document.getElementById(t);else if(!t instanceof HTMLCanvasElement)return;t.style.width=i+"px",t.style.height=s+"px",t.width=i,t.height=s;var o=t.getContext("2d");o.clearRect(0,0,i,s),o.drawImage(e,0,0);if(isNaN(n)||n<1)return;r?u(t,0,0,i,s,n):f(t,0,0,i,s,n)}function o(e,t,n,r,i){if(typeof e=="string")var e=document.getElementById(e);else if(!e instanceof HTMLCanvasElement)return;var s=e.getContext("2d"),o;try{try{o=s.getImageData(t,n,r,i)}catch(u){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),o=s.getImageData(t,n,r,i)}catch(u){throw alert("Cannot access local image"),new Error("unable to access local image data: "+u)}}}catch(u){throw alert("Cannot access image"),new Error("unable to access image data: "+u)}return o}function u(e,t,n,r,i,s){if(isNaN(s)||s<1)return;s|=0;var u=o(e,t,n,r,i);u=a(u,t,n,r,i,s),e.getContext("2d").putImageData(u,t,n)}function a(e,t,n,s,o,u){var a=e.data,f,l,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P=u+u+1,H=s<<2,B=s-1,j=o-1,F=u+1,I=F*(F+1)/2,q=new c,R=q;for(h=1;h<P;h++){R=R.next=new c;if(h==F)var U=R}R.next=q;var z=null,W=null;m=v=0;var X=r[u],V=i[u];for(l=0;l<o;l++){N=C=k=L=g=y=b=w=0,E=F*(A=a[v]),S=F*(O=a[v+1]),x=F*(M=a[v+2]),T=F*(_=a[v+3]),g+=I*A,y+=I*O,b+=I*M,w+=I*_,R=q;for(h=0;h<F;h++)R.r=A,R.g=O,R.b=M,R.a=_,R=R.next;for(h=1;h<F;h++)p=v+((B<h?B:h)<<2),g+=(R.r=A=a[p])*(D=F-h),y+=(R.g=O=a[p+1])*D,b+=(R.b=M=a[p+2])*D,w+=(R.a=_=a[p+3])*D,N+=A,C+=O,k+=M,L+=_,R=R.next;z=q,W=U;for(f=0;f<s;f++)a[v+3]=_=w*X>>V,_!=0?(_=255/_,a[v]=(g*X>>V)*_,a[v+1]=(y*X>>V)*_,a[v+2]=(b*X>>V)*_):a[v]=a[v+1]=a[v+2]=0,g-=E,y-=S,b-=x,w-=T,E-=z.r,S-=z.g,x-=z.b,T-=z.a,p=m+((p=f+u+1)<B?p:B)<<2,N+=z.r=a[p],C+=z.g=a[p+1],k+=z.b=a[p+2],L+=z.a=a[p+3],g+=N,y+=C,b+=k,w+=L,z=z.next,E+=A=W.r,S+=O=W.g,x+=M=W.b,T+=_=W.a,N-=A,C-=O,k-=M,L-=_,W=W.next,v+=4;m+=s}for(f=0;f<s;f++){C=k=L=N=y=b=w=g=0,v=f<<2,E=F*(A=a[v]),S=F*(O=a[v+1]),x=F*(M=a[v+2]),T=F*(_=a[v+3]),g+=I*A,y+=I*O,b+=I*M,w+=I*_,R=q;for(h=0;h<F;h++)R.r=A,R.g=O,R.b=M,R.a=_,R=R.next;d=s;for(h=1;h<=u;h++)v=d+f<<2,g+=(R.r=A=a[v])*(D=F-h),y+=(R.g=O=a[v+1])*D,b+=(R.b=M=a[v+2])*D,w+=(R.a=_=a[v+3])*D,N+=A,C+=O,k+=M,L+=_,R=R.next,h<j&&(d+=s);v=f,z=q,W=U;for(l=0;l<o;l++)p=v<<2,a[p+3]=_=w*X>>V,_>0?(_=255/_,a[p]=(g*X>>V)*_,a[p+1]=(y*X>>V)*_,a[p+2]=(b*X>>V)*_):a[p]=a[p+1]=a[p+2]=0,g-=E,y-=S,b-=x,w-=T,E-=z.r,S-=z.g,x-=z.b,T-=z.a,p=f+((p=l+F)<j?p:j)*s<<2,g+=N+=z.r=a[p],y+=C+=z.g=a[p+1],b+=k+=z.b=a[p+2],w+=L+=z.a=a[p+3],z=z.next,E+=A=W.r,S+=O=W.g,x+=M=W.b,T+=_=W.a,N-=A,C-=O,k-=M,L-=_,W=W.next,v+=s}return e}function f(e,t,n,r,i,s){if(isNaN(s)||s<1)return;s|=0;var u=o(e,t,n,r,i);u=l(u,t,n,r,i,s),e.getContext("2d").putImageData(u,t,n)}function l(e,t,n,s,o,u){var a=e.data,f,l,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O=u+u+1,M=s<<2,_=s-1,D=o-1,P=u+1,H=P*(P+1)/2,B=new c,j=B;for(h=1;h<O;h++){j=j.next=new c;if(h==P)var F=j}j.next=B;var I=null,q=null;m=v=0;var R=r[u],U=i[u];for(l=0;l<o;l++){x=T=N=g=y=b=0,w=P*(C=a[v]),E=P*(k=a[v+1]),S=P*(L=a[v+2]),g+=H*C,y+=H*k,b+=H*L,j=B;for(h=0;h<P;h++)j.r=C,j.g=k,j.b=L,j=j.next;for(h=1;h<P;h++)p=v+((_<h?_:h)<<2),g+=(j.r=C=a[p])*(A=P-h),y+=(j.g=k=a[p+1])*A,b+=(j.b=L=a[p+2])*A,x+=C,T+=k,N+=L,j=j.next;I=B,q=F;for(f=0;f<s;f++)a[v]=g*R>>U,a[v+1]=y*R>>U,a[v+2]=b*R>>U,g-=w,y-=E,b-=S,w-=I.r,E-=I.g,S-=I.b,p=m+((p=f+u+1)<_?p:_)<<2,x+=I.r=a[p],T+=I.g=a[p+1],N+=I.b=a[p+2],g+=x,y+=T,b+=N,I=I.next,w+=C=q.r,E+=k=q.g,S+=L=q.b,x-=C,T-=k,N-=L,q=q.next,v+=4;m+=s}for(f=0;f<s;f++){T=N=x=y=b=g=0,v=f<<2,w=P*(C=a[v]),E=P*(k=a[v+1]),S=P*(L=a[v+2]),g+=H*C,y+=H*k,b+=H*L,j=B;for(h=0;h<P;h++)j.r=C,j.g=k,j.b=L,j=j.next;d=s;for(h=1;h<=u;h++)v=d+f<<2,g+=(j.r=C=a[v])*(A=P-h),y+=(j.g=k=a[v+1])*A,b+=(j.b=L=a[v+2])*A,x+=C,T+=k,N+=L,j=j.next,h<D&&(d+=s);v=f,I=B,q=F;for(l=0;l<o;l++)p=v<<2,a[p]=g*R>>U,a[p+1]=y*R>>U,a[p+2]=b*R>>U,g-=w,y-=E,b-=S,w-=I.r,E-=I.g,S-=I.b,p=f+((p=l+P)<D?p:D)*s<<2,g+=x+=I.r=a[p],y+=T+=I.g=a[p+1],b+=N+=I.b=a[p+2],I=I.next,w+=C=q.r,E+=k=q.g,S+=L=q.b,x-=C,T-=k,N-=L,q=q.next,v+=s}return e}function c(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var r=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],i=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];t.exports={image:s,canvasRGBA:u,canvasRGB:f,imageDataRGBA:a,imageDataRGB:l}},{}],29:[function(e,t,n){var r=arguments[3],i=arguments[4],s=arguments[5],o=JSON.stringify;t.exports=function(e){var t=[],n,u=Object.keys(s);for(var a=0,f=u.length;a<f;a++){var l=u[a],c=s[l].exports;if(c===e||c.default===e){n=l;break}}if(!n){n=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var h={};for(var a=0,f=u.length;a<f;a++){var l=u[a];h[l]=l}i[n]=[Function(["require","module","exports"],"("+e+")(self)"),h]}var p=Math.floor(Math.pow(16,8)*Math.random()).toString(16),d={};d[n]=n,i[p]=[Function(["require"],"var f = require("+o(n)+");"+"(f.default ? f.default : f)(self);"),d];var v="("+r+")({"+Object.keys(i).map(function(e){return o(e)+":["+i[e][0]+","+o(i[e][1])+"]"}).join(",")+"},{},["+o(p)+"])",m=window.URL||window.webkitURL||window.mozURL||window.msURL;return new Worker(m.createObjectURL(new Blob([v],{type:"text/javascript"})))}},{}]},{},[1])(1)}),define("src/process",["lib/triangulate-image-with-polyfills"],function(e){function c(e){o=e.signals,o["image-loaded"].add(p),o["control-updated"].add(h),o["export-requested"].add(b)}function h(e){i=w(e),d()}function p(e){r||(s=e,v(s))}function d(){!r&&s&&v(s)}function v(s){r=!0,y(t,n),g(t,s,l),e(i).fromImage(s).toImageData({dpr:l}).then(function(e){m(n,e)}),r=!1}function m(e,t){e.putImageData(t,0,0)}function g(e,t,n){e.width=t.width*n,e.height=t.height*n,e.style.width=e.width/n+"px",e.style.height=e.height/n+"px"}function y(e,t){t.clearRect(t,0,0,e.width,e.height)}function b(n){if(typeof n=="function"){var r={png:t.toDataURL("image/png"),svg:e(i).fromImageSync(s).toSVGSync()};n(r)}}function w(e){var t={};for(var n in e){switch(n){case"blur":t[n]=parseInt(E(e[n],0,100,1,100),10);break;case"accuracy":t[n]=E(e[n],0,100,1,.1);break;case"vertex-count":t.vertexCount=parseInt(E(e[n],0,100,100,5e3),10)}t.fill=!!e.fill,t.strokeWidth=E(e["stroke-width"],0,100,0,100)}return t}function E(e,t,n,r,i){return r+(i-r)*(e-t)/(n-t)}var t=document.getElementById("canvas"),n=t.getContext("2d"),r=!1,i,s,o,u,a,f,l=window.devicePixelRatio&&window.devicePixelRatio>1?window.devicePixelRatio:1;return{init:c}}),define("src/image",[],function(){function i(n){e=n.signals,t=new Image,e["set-new-src"].add(o),t.addEventListener("load",s,!1),o(r)}function s(){e["image-loaded"].dispatch(t),n&&e["close-intro"].dispatch(),n=!0}function o(e){t.src=e,n&&t.naturalWidth!==undefined&&t.naturalWidth!==0&&setTimeout(s,10)}var e,t,n=!1,r=document.body.getAttribute("data-defaultimage");return{init:i}}),define("src/file",[],function(){function i(r){e=r.signals,n=r.feature,n["file-api"]&&(e["load-file"].add(s),t=new FileReader,t.addEventListener("load",o,!1))}function s(e){e&&e.type&&r.indexOf(e.type)!==-1&&t.readAsDataURL(e)}function o(t){e["set-new-src"].dispatch(t.target.result)}var e,t,n,r=["image/png","image/jpg","image/jpeg"];return{init:i}}),define("src/dragdrop",[],function(){function n(n){t=n.feature,e=n.signals,t["drag-drop"]&&(document.addEventListener("drop",i,!1),document.addEventListener("dragover",r,!1),document.addEventListener("dragleave",r,!1))}function r(e){e.preventDefault()}function i(t){t.preventDefault(),t.dataTransfer&&t.dataTransfer.files&&t.dataTransfer.files[0]&&(e["load-file"].dispatch(t.dataTransfer.files[0]),e["close-intro"].dispatch())}var e,t;return{init:n}}),define("src/controls",[],function(){function o(i){n=i.signals;if(i.feature["query-selector-all"]){var s=document.getElementById("controls");r=s.querySelectorAll(".control-input"),s.className+=" is-active";for(var o=0;o<r.length;o++){var p=r[o];p.addEventListener("change",u,!1),f(h(p.id),d(p)),l(c(p.id),d(p))}t=!0,n["control-set"].add(a),n["control-updated"].dispatch(e)}}function u(e){clearTimeout(i),i=setTimeout(function(){e.target&&(e=e.target),f(h(e.id),d(e)),l(c(e.id),d(e))},100)}function a(t){var r,i={};for(var s in t)r=c(s),p(r,t[s]),u(r),i[h(s)]=t[s];e=i,n["control-updated"].dispatch(e)}function f(r,i){typeof i!="undefined"&&(e[r]=i,t&&n["control-updated"].dispatch(e))}function l(e,t){e&&d(e)!==t&&typeof t!="undefined"&&p(e,t)}function c(e){var t,n=h(e),i;for(var s=0,o=r.length;s<o;s++){i=r[s].id;if(i.indexOf(n)!==-1)if(r[s].type==="checkbox"){if(i===e){t=r[s];break}}else if(i!==e){t=r[s];break}}return t}function h(e){return e.replace("-slider","").replace("-number","").replace("-input","")}function p(e,t){e[v(e)]=t}function d(e){return e[v(e)]}function v(e){return e.type==="checkbox"?"checked":"value"}var e={},t=!1,n,r,i,s=!1;return{init:o}}),define("src/export-button",[],function(){function i(i){e=i.signals,t=document.getElementById("export-button"),n=document.getElementById("png-link"),r=document.getElementById("svg-link"),t.addEventListener("click",s,!1),n.addEventListener("click",u,!1),r.addEventListener("click",a,!1)}function s(t){t.preventDefault(),e["export-requested"].dispatch(o)}function o(e){n.href=e.png,n.classList.add("is-active");var t=new Blob([e.svg],{type:"image/svg+xml"}),i=window.URL.createObjectURL(t);r.href=i,r.classList.add("is-active")}function u(){n.classList.remove("is-active")}function a(){r.classList.remove("is-active")}var e,t,n,r;return{init:i}}),define("util/trigger-event",[],function(){function e(e,t){var n;if(e.ownerDocument)n=e.ownerDocument;else{if(e.nodeType!==9)throw new Error("Invalid node passed to fireEvent: "+e.id);n=e}if(e.fireEvent){var r=n.createEventObject();r.synthetic=!0,e.fireEvent("on"+t,r)}else if(e.dispatchEvent){var i="";switch(t){case"click":case"mousedown":case"mouseup":i="MouseEvents";break;case"focus":case"change":case"blur":case"select":i="HTMLEvents";break;default:throw"triggerEvent: Couldn’t find an event class for event "+t+"."}var r=n.createEvent(i),s=t=="change"?!1:!0;r.initEvent(t,s,!0),r.synthetic=!0,e.dispatchEvent(r)}}return e}),define("src/import-button",["util/trigger-event"],function(e){function a(e){n=e.signals,t=e.feature,t["file-api"]&&(s=new FileReader,r=document.getElementById("import-button"),i=document.getElementById("import-input"),r.addEventListener("click",f,!1),i.addEventListener("change",l,!1))}function f(t){t.preventDefault(),u||e(i,"click")}function l(e){var t=e.target.files;e.target&&e.target.files&&e.target.files[0]&&(n["load-file"].dispatch(e.target.files[0]),n["close-intro"].dispatch())}var t,n,r,i,s,o,u=!1;return{init:a}}),define("src/random-button",[],function(){function s(s){e=s.signals,s.feature["query-selector-all"]&&(t=document.querySelectorAll(".control-slider"),n=document.querySelectorAll(".checkbox"),i=a(t),r=document.getElementById("random-button"),r.addEventListener("click",o,!1),r.classList.remove("is-hidden"))}function o(e){e.preventDefault(),u()}function u(){var t={},r,s;for(var o in i)r=i[o],t[o]=f(r.min,r.max);for(var u=0,a=n.length;u<a;u++)s=n[u],t[s.id]=Math.random()>.5;e["control-set"].dispatch(t)}function a(e){var t={},n;for(var r=0,i=e.length;r<i;r++)n=e[r],t[n.id]={min:parseInt(n.min,10),max:parseInt(n.max,10)};return t}function f(e,t){return Math.floor(Math.random()*(t-e+1))+e}var e,t,n,r,i={};return{init:s}}),!function(e,t,n){typeof module!="undefined"&&module.exports?module.exports=n():typeof define=="function"&&define.amd?define("lib/reqwest",n):t[e]=n()}("reqwest",this,function(){function handleReadyState(e,t,n){return function(){if(e._aborted)return n(e.request);e.request&&e.request[readyState]==4&&(e.request.onreadystatechange=noop,twoHundo.test(e.request.status)?t(e.request):n(e.request))}}function setHeaders(e,t){var n=t.headers||{},r;n.Accept=n.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"],!t.crossOrigin&&!n[requestedWith]&&(n[requestedWith]=defaultHeaders.requestedWith),n[contentType]||(n[contentType]=t.contentType||defaultHeaders.contentType);for(r in n)n.hasOwnProperty(r)&&"setRequestHeader"in e&&e.setRequestHeader(r,n[r])}function setCredentials(e,t){typeof t.withCredentials!="undefined"&&typeof e.withCredentials!="undefined"&&(e.withCredentials=!!t.withCredentials)}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,r){var i=uniqid++,s=e.jsonpCallback||"callback",o=e.jsonpCallbackName||reqwest.getcallbackPrefix(i),u=new RegExp("((^|\\?|&)"+s+")=([^&]+)"),a=r.match(u),f=doc.createElement("script"),l=0,c=navigator.userAgent.indexOf("MSIE 10.0")!==-1;return a?a[3]==="?"?r=r.replace(u,"$1="+o):o=a[3]:r=urlappend(r,s+"="+o),win[o]=generalCallback,f.type="text/javascript",f.src=r,f.async=!0,typeof f.onreadystatechange!="undefined"&&!c&&(f.event="onclick",f.htmlFor=f.id="_reqwest_"+i),f.onload=f.onreadystatechange=function(){if(f[readyState]&&f[readyState]!=="complete"&&f[readyState]!=="loaded"||l)return!1;f.onload=f.onreadystatechange=null,f.onclick&&f.onclick(),t(lastValue),lastValue=undefined,head.removeChild(f),l=1},head.appendChild(f),{abort:function(){f.onload=f.onreadystatechange=null,n({},"Request is aborted: timeout",{}),lastValue=undefined,head.removeChild(f),l=1}}}function getRequest(e,t){var n=this.o,r=(n.method||"GET").toUpperCase(),i=typeof n=="string"?n:n.url,s=n.processData!==!1&&n.data&&typeof n.data!="string"?reqwest.toQueryString(n.data):n.data||null,o,u=!1;return(n.type=="jsonp"||r=="GET")&&s&&(i=urlappend(i,s),s=null),n.type=="jsonp"?handleJsonp(n,e,t,i):(o=xhr(n),o.open(r,i,n.async===!1?!1:!0),setHeaders(o,n),setCredentials(o,n),win[xDomainRequest]&&o instanceof win[xDomainRequest]?(o.onload=e,o.onerror=t,o.onprogress=function(){},u=!0):o.onreadystatechange=handleReadyState(this,e,t),n.before&&n.before(o),u?setTimeout(function(){o.send(s)},200):o.send(s),o)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){var t=e.match(/\.(json|jsonp|html|xml)(\?|$)/);return t?t[1]:"js"}function init(o,fn){function complete(e){o.timeout&&clearTimeout(self.timeout),self.timeout=null;while(self._completeHandlers.length>0)self._completeHandlers.shift()(e)}function success(resp){resp=type!=="jsonp"?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);while(self._fulfillmentHandlers.length>0)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function error(e,t,n){e=self.request,self._responseArgs.resp=e,self._responseArgs.msg=t,self._responseArgs.t=n,self._erred=!0;while(self._errorHandlers.length>0)self._errorHandlers.shift()(e,t,n);complete(e)}this.url=typeof o=="string"?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this,type=o.type||setType(this.url);fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n=e.name,r=e.tagName.toLowerCase(),i=function(e){e&&!e.disabled&&t(n,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))},s,o,u,a;if(e.disabled||!n)return;switch(r){case"input":/reset|button|image|file/i.test(e.type)||(s=/checkbox/i.test(e.type),o=/radio/i.test(e.type),u=e.value,(!s&&!o||e.checked)&&t(n,normalize(s&&u===""?"on":u)));break;case"textarea":t(n,normalize(e.value));break;case"select":if(e.type.toLowerCase()==="select-one")i(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(a=0;e.length&&a<e.length;a++)e.options[a].selected&&i(e.options[a])}}function eachFormElement(){var e=this,t,n,r=function(t,n){var r,i,s;for(r=0;r<n.length;r++){s=t[byTag](n[r]);for(i=0;i<s.length;i++)serial(s[i],e)}};for(n=0;n<arguments.length;n++)t=arguments[n],/input|select|textarea/i.test(t.tagName)&&serial(t,e),r(t,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,n){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n},arguments),e}function buildParams(e,t,n,r){var i,s,o,u=/\[\]$/;if(isArray(t))for(s=0;t&&s<t.length;s++)o=t[s],n||u.test(e)?r(e,o):buildParams(e+"["+(typeof o=="object"?s:"")+"]",o,n,r);else if(t&&t.toString()==="[object Object]")for(i in t)buildParams(e+"["+i+"]",t[i],n,r);else r(e,t)}var win=window,doc=document,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,callbackPrefix="reqwest_"+ +(new Date),lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray=typeof Array.isArray=="function"?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(e){if(e.crossOrigin===!0){var t=win[xmlHttpRequest]?new XMLHttpRequest:null;if(t&&"withCredentials"in t)return t;if(win[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return win[xmlHttpRequest]?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(e){return e}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){return e=e||function(){},t=t||function(){},this._fulfilled?this._responseArgs.resp=e(this._responseArgs.resp):this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(e),this._errorHandlers.push(t)),this},always:function(e){return this._fulfilled||this._erred?e(this._responseArgs.resp):this._completeHandlers.push(e),this},fail:function(e){return this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(e),this}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments),e},reqwest.serialize=function(){if(arguments.length===0)return"";var e,t,n=Array.prototype.slice.call(arguments,0);return e=n.pop(),e&&e.nodeType&&n.push(e)&&(e=null),e&&(e=e.type),e=="map"?t=serializeHash:e=="array"?t=reqwest.serializeArray:t=serializeQueryString,t.apply(null,n)},reqwest.toQueryString=function(e,t){var n,r,i=t||!1,s=[],o=encodeURIComponent,u=function(e,t){t="function"==typeof t?t():t==null?"":t,s[s.length]=o(e)+"="+o(t)};if(isArray(e))for(r=0;e&&r<e.length;r++)u(e[r].name,e[r].value);else for(n in e)buildParams(n,e[n],i,u);return s.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest.ajaxSetup=function(e){e=e||{};for(var t in e)globalSetupOptions[t]=e[t]},reqwest}),define("src/upload-imgur",["lib/reqwest"],function(e,t){function h(e){n=e.signals,r=document.getElementById("imgur-button"),i=document.getElementById("imgur-url-container"),s=document.getElementById("imgur-url-input"),o=document.getElementById("imgur-url-link"),u=document.getElementById("imgur-url-error"),a=document.getElementById("twitter-link"),f=document.getElementById("facebook-link"),l=document.getElementById("reddit-link"),r.addEventListener("click",p,!1),s.addEventListener("click",d,!1)}function p(e){e.preventDefault(),c||(n["export-requested"].dispatch(v),i.classList.remove("is-active","upload-failed","upload-successful"))}function d(){s.select()}function v(t){c||(r.classList.add("is-uploading"),c=!0,e({url:"https://api.imgur.com/3/image.json",method:"POST",headers:{Authorization:"Client-ID a4c24380d884932"},data:{image:t.png.split(",")[1],type:"base64"},type:"json",crossOrigin:!0,success:m,error:g}))}function m(e){c=!1;if(e&&e.data&&e.data.link){var t="Check out what I made with @snorpey’s triangulation tool: ";t+=e.data.link,t+=" http://snorpey.github.io/triangulation";var n="https://www.facebook.com/sharer/sharer.php?s=100";n+="&p[url]="+e.data.link,n+="&p[title]=Triangles!",n+="&p[images][0]="+e.data.link,n+="&p[summary]="+encodeURIComponent("Check out what I made with this triangulation tool: http://snorpey.github.io/triangulation"),r.classList.remove("is-uploading"),s.setAttribute("value",e.data.link),o.href=e.data.link,i.classList.add("is-active","upload-successful"),a.href="https://twitter.com/intent/tweet?text="+encodeURIComponent(t),f.href=n,l.href="https://www.reddit.com/submit?url="+encodeURIComponent(e.data.link)+"&title=Triangles!"}else g()}function g(e){c=!1,r.classList.remove("is-uploading"),i.classList.add("is-active","upload-failed")}var n,r,i,s,o,u,a,f,l,c=!1;return{init:h}}),define("src/intro",[],function(){function s(t){e=t.signals,r.addEventListener("click",o),i.addEventListener("click",a),e["close-intro"].add(a)}function o(e){t?a():u()}function u(){r.classList.add("is-active"),n.classList.add("is-active"),t=!0}function a(){r.classList.remove("is-active"),n.classList.remove("is-active"),t=!1}var e,t=!0,n=document.querySelectorAll(".intro")[0],r=document.querySelectorAll(".intro-button")[0],i=n.querySelectorAll(".close")[0];return{init:s}}),function(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||!1}(),define("lib/getusermedia",function(){}),define("src/cam",["lib/getusermedia"],function(){function u(r){o=r.signals;if(navigator.getUserMedia){e.classList.add("is-supported"),e.addEventListener("click",a),t=document.createElement("div"),t.classList.add("cam-wrapper");var s=document.createElement("div");s.textContent="Take Picture",s.classList.add("take-picture"),s.classList.add("button"),s.addEventListener("click",c),t.appendChild(s),n=document.createElement("video"),n.classList.add("cam"),n.addEventListener("click",c),t.appendChild(n),document.body.appendChild(t),i=document.createElement("canvas")}}function a(e){var t={video:!0};navigator.getUserMedia(t,f,l)}function f(e){var o;window.webkitURL?o=window.URL.createObjectURL(e):o=e,n.mozSrcObject!==undefined?n.mozSrcObject=o:n.src=o,r=e,n.play(),n.style.display="block",t.classList.add("is-active"),i.width=640,i.height=480,s=i.getContext("2d")}function l(){console.log("sorry, but there was an error accessing you camera...")}function c(e){s.translate(i.width,0),s.scale(-1,1),s.drawImage(n,0,0);var u=s.getImageData(0,0,i.width,i.height),a=i.toDataURL("image/png");t.classList.remove("is-active"),o["set-new-src"].dispatch(a),setTimeout(function(){r.stop()},500)}var e=document.getElementById("cam-button"),t,n,r,i,s,o;return{init:u}}),define("util/feature-test",[],function(){function t(t,n){var r=!0,i={},s=[];for(var o in e){var u=e[o].test();u||e[o].required&&(r=!1,s.push(o)),i[o]=u}r?t(i):n(s,i)}var e={canvas:{required:!0,test:function(){return!!document.createElement("canvas").getContext}},"query-selector-all":{required:!1,test:function(){return!!document.querySelectorAll}},"drag-drop":{required:!1,test:function(){return"draggable"in document.createElement("span")}},"file-api":{required:!1,test:function(){return typeof FileReader!="undefined"}}};return t}),function(e){function t(e,t,n,r,i){this._listener=t,this._isOnce=n,this.context=r,this._signal=e,this._priority=i||0}function n(e,t){if(typeof e!="function")throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function r(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){r.prototype.dispatch.apply(e,arguments)}}t.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&!!this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},r.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,n,r,i){var s=this._indexOfListener(e,r),o;if(s!==-1){o=this._bindings[s];if(o.isOnce()!==n)throw new Error("You cannot add"+(n?"":"Once")+"() then add"+(n?"Once":"")+"() the same listener without removing the relationship first.")}else o=new t(this,e,n,r,i),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},_addBinding:function(e){var t=this._bindings.length;do--t;while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){var n=this._bindings.length,r;while(n--){r=this._bindings[n];if(r._listener===e&&r.context===t)return n}return-1},has:function(e,t){return this._indexOfListener(e,t)!==-1},add:function(e,t,r){return n(e,"add"),this._registerListener(e,!1,t,r)},addOnce:function(e,t,r){return n(e,"addOnce"),this._registerListener(e,!0,t,r)},remove:function(e,t){n(e,"remove");var r=this._indexOfListener(e,t);return r!==-1&&(this._bindings[r]._destroy(),this._bindings.splice(r,1)),e},removeAll:function(){var e=this._bindings.length;while(e--)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(!this.active)return;var t=Array.prototype.slice.call(arguments),n=this._bindings.length,r;this.memorize&&(this._prevParams=t);if(!n)return;r=this._bindings.slice(),this._shouldPropagate=!0;do n--;while(r[n]&&this._shouldPropagate&&r[n].execute(t)!==!1)},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var i=r;i.Signal=r,typeof define=="function"&&define.amd?define("lib/signals-1.0.0",[],function(){return i}):typeof module!="undefined"&&module.exports?module.exports=i:e.signals=i}(this);var path=typeof _basepath_=="string"?_basepath_+"/":"";requirejs.config({baseUrl:path+"scripts/",waitSeconds:50,urlArgs:"bust="+(new Date).getTime()}),require(["src/process","src/image","src/file","src/dragdrop","src/controls","src/export-button","src/import-button","src/random-button","src/upload-imgur","src/intro","src/cam","util/feature-test","lib/signals-1.0.0"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){function p(c){var p={feature:c,signals:{"load-file":new h,"image-loaded":new h,"set-new-src":new h,"control-set":new h,"control-updated":new h,"close-intro":new h,"export-requested":new h}};e.init(p),r.init(p),i.init(p),s.init(p),o.init(p),u.init(p),t.init(p),n.init(p),a.init(p),f.init(p),l.init(p)}function d(e){var t=document.createElement("div"),n="sorry. it looks like your browser is missing some of the features ";n+="("+e.join(", ")+") that are required to run this ",n+="experiment.",t.innerText=n,t.className="missing-feature",document.getElementsByTagName("body")[0].appendChild(t)}c(p,d)}),define("main",function(){})})();